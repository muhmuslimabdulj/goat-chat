package components

templ ChatInput() {
<div class="border-t-4 border-black bg-white p-4 transition-all duration-300 relative" :class="chatInputMarginClass">
	<form class="flex gap-3" @submit.prevent="sendMessage">
		<!-- Message Input -->
		<div class="flex-1 relative">
			<input type="text" x-model="messageInput" 
				@input="sendTyping(true); checkMentionTrigger($event); checkCommandTrigger($event)"
				@blur="setTimeout(() => { showMentionPicker = false; showCommandPicker = false; }, 150)"
				@keydown.escape="showMentionPicker = false; showCommandPicker = false"
				@keydown.arrow-down.prevent="showCommandPicker ? commandNavDown() : mentionNavDown()"
				@keydown.arrow-up.prevent="showCommandPicker ? commandNavUp() : mentionNavUp()"
				@keydown.enter="if(showCommandPicker && filteredCommands.length) { $event.preventDefault(); selectCommand(filteredCommands[commandSelectedIndex]); } else if(showMentionPicker && filteredMentions.length) { $event.preventDefault(); selectMention(filteredMentions[mentionSelectedIndex]); }"
				@keydown.tab.prevent="if(showCommandPicker && filteredCommands.length) selectCommand(filteredCommands[commandSelectedIndex]); else if(showMentionPicker && filteredMentions.length) selectMention(filteredMentions[mentionSelectedIndex])"
				placeholder="Ketik / untuk perintah, @ untuk mention"
				class="w-full px-4 py-3 text-lg font-bold border-3 border-black bg-gray-50 focus:bg-white focus:outline-none focus:ring-4 focus:ring-black transition-all placeholder:font-normal placeholder:text-gray-400"
				aria-label="Pesan chat" autocomplete="off" x-ref="chatInput" />
			
			<!-- Command Picker Dropdown -->
			<div x-show="showCommandPicker && filteredCommands.length > 0" x-transition x-ref="commandList"
				class="absolute bottom-full left-0 right-0 mb-2 bg-white border-4 border-black shadow-brutal max-h-48 overflow-y-auto z-50">
				<template x-for="(cmd, index) in filteredCommands" :key="cmd.cmd">
					<button type="button" @click="selectCommand(cmd)" :id="'cmd-item-' + index"
						class="w-full px-3 py-2 text-left flex items-center gap-2 hover:bg-yellow-100 transition-colors border-b border-gray-200 last:border-b-0"
						:class="commandSelectedIndex === index ? 'bg-yellow-200' : ''">
						<code class="bg-black text-white text-[10px] px-1.5 py-0.5 rounded font-mono font-bold shrink-0" x-text="cmd.cmd"></code>
						<span class="text-xs text-gray-700 truncate" x-text="cmd.desc"></span>
					</button>
				</template>
			</div>
			
			<!-- Mention Picker Dropdown -->
			<div x-show="showMentionPicker && filteredMentions.length > 0 && !showCommandPicker" x-transition x-ref="mentionList"
				class="absolute bottom-full left-0 right-0 mb-2 bg-white border-4 border-black shadow-brutal max-h-48 overflow-y-auto z-50">
				<template x-for="(user, index) in filteredMentions" :key="user.id">
					<button type="button" @click="selectMention(user)" :id="'mention-item-' + index"
						class="w-full px-4 py-3 text-left flex items-center gap-3 hover:bg-purple-100 transition-colors border-b-2 border-gray-200 last:border-b-0"
						:class="mentionSelectedIndex === index ? 'bg-purple-200' : ''">
						<div class="w-8 h-8 rounded-full border-3 border-black flex items-center justify-center text-sm font-bold shrink-0"
							:style="'background-color: ' + user.color"
							x-text="user.persona.charAt(0)"></div>
						<div class="flex-1 min-w-0">
							<div class="font-bold text-sm truncate" x-text="user.persona"></div>
						</div>
						<span class="text-xs text-gray-400 font-mono" x-text="'@' + user.persona.replace(/\\s+/g, '_')"></span>
					</button>
				</template>
			</div>
		</div>

		<!-- Send Button -->
		<button type="submit"
			class="px-6 py-3 font-black text-white rounded-none border-3 border-black shadow-[4px_4px_0px_0px_#000] bg-black hover:bg-gray-800 hover:shadow-[2px_2px_0px_0px_#000] hover:translate-x-[2px] hover:translate-y-[2px] active:shadow-none transition-all uppercase tracking-wide"
			aria-label="Kirim pesan">
			Kirim ğŸš€
		</button>
	</form>

	<!-- Action Buttons (Horizontal Scroll on Mobile) -->
	<div
		class="flex gap-2 mt-3 overflow-x-auto pb-2 -mx-4 px-4 lg:mx-0 lg:px-0 lg:flex-wrap lg:overflow-visible items-center scrollbar-hide">

		<!-- Theme Selector (Styled) -->
		<div class="relative shrink-0">
			<select @change="setTheme($event.target.value)"
				class="appearance-none pl-3 pr-8 py-2 text-sm font-bold border-3 border-black bg-white shadow-[2px_2px_0px_0px_#000] cursor-pointer hover:bg-gray-50 focus:outline-none">
				<option value="default">ğŸ¨ Default</option>
				<option value="dark">ğŸŒ™ Dark</option>
				<option value="ocean">ğŸŒŠ Ocean</option>
				<option value="candy">ğŸ¬ Candy</option>
				<option value="forest">ğŸŒ² Forest</option>
			</select>
			<div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-black font-bold">â–¼
			</div>
		</div>

		<!-- Nudge Button -->
		<button @click="sendNudge"
			class="shrink-0 px-4 py-2 text-sm font-black border-3 border-black shadow-[2px_2px_0px_0px_#000] bg-neon-pink text-white hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-[1px_1px_0px_0px_#000] active:shadow-none transition-all uppercase whitespace-nowrap">
			ğŸ“³ Nudge!
		</button>

		<!-- Chaos Mode Button -->
		<button @click="sendChaos"
			class="shrink-0 px-4 py-2 text-sm font-black border-3 border-black shadow-[2px_2px_0px_0px_#000] bg-neon-purple text-white hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-[1px_1px_0px_0px_#000] active:shadow-none transition-all uppercase whitespace-nowrap">
			ğŸª© Chaos!
		</button>

		<!-- Confetti Button -->
		<button @click="sendConfetti"
			class="shrink-0 px-4 py-2 text-sm font-black border-3 border-black shadow-[2px_2px_0px_0px_#000] bg-neon-yellow text-black hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-[1px_1px_0px_0px_#000] active:shadow-none transition-all uppercase whitespace-nowrap">
			ğŸŠ Confetti
		</button>

		<!-- GIF Button -->
		<button @click="showGifPicker = !showGifPicker"
			class="shrink-0 px-4 py-2 text-sm font-black border-3 border-black shadow-[2px_2px_0px_0px_#000] bg-neon-cyan text-black hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-[1px_1px_0px_0px_#000] active:shadow-none transition-all uppercase whitespace-nowrap">
			ğŸ–¼ï¸ GIF
		</button>

		<!-- Reaction Buttons -->
		<div class="flex gap-1 lg:ml-auto shrink-0 border-l-2 border-gray-300 pl-2 lg:border-none lg:pl-0">
			<template x-for="emoji in ['ğŸ‰', 'ğŸ˜‚', 'â¤ï¸', 'ğŸ”¥', 'ğŸ’€']">
				<button @click="sendReaction(emoji)"
					class="w-10 h-10 flex items-center justify-center text-xl border-3 border-black shadow-[2px_2px_0px_0px_#000] bg-white hover:bg-gray-100 hover:translate-x-[1px] hover:translate-y-[1px] active:shadow-none transition-all shrink-0"
					x-text="emoji"></button>
			</template>
		</div>
	</div>

	<!-- GIF Picker Modal (Centered Overlay) -->
	<div x-show="showGifPicker" style="display: none;"
		class="fixed inset-0 z-[100] flex items-center justify-center p-2 sm:p-4 bg-black/50"
		x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0"
		x-transition:enter-end="opacity-100" x-transition:leave="transition ease-in duration-150"
		x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0">

		<!-- Modal Content - Simple Block Layout -->
		<div @click.away="showGifPicker = false"
			class="w-full max-w-md bg-white border-4 border-black shadow-[4px_4px_0px_0px_#000] p-3"
			x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 scale-95"
			x-transition:enter-end="opacity-100 scale-100">

			<!-- Header -->
			<div class="flex items-center justify-between mb-3">
				<h3 class="text-lg font-black uppercase">ğŸ–¼ï¸ GIF</h3>
				<button @click="showGifPicker = false" class="text-2xl leading-none">âœ•</button>
			</div>

			<!-- Search Bar -->
			<div class="flex gap-2 mb-3">
				<input type="text" x-model="gifSearchQuery" @keyup.enter="searchGifs(gifSearchQuery)"
					placeholder="Cari GIF..." class="flex-1 min-w-0 px-3 py-2 text-base font-bold border-3 border-black"
					autofocus />
				<button @click="searchGifs(gifSearchQuery)"
					class="px-4 py-2 font-black bg-neon-green border-3 border-black text-sm">
					ğŸ”
				</button>
			</div>

			<!-- Grid Results - SIMPLE: Fixed max-height, always scrollable -->
			<div class="max-h-[60vh] overflow-y-auto border-2 border-black bg-gray-100 p-2">
				<div class="grid grid-cols-2 sm:grid-cols-3 gap-2">
					<template x-for="gif in gifResults" :key="gif.url">
						<div @click="sendGif(gif.url)"
							class="cursor-pointer border-2 border-black bg-white active:scale-95 transition-transform">
							<img :src="gif.preview || gif.url" class="w-full h-24 sm:h-28 object-cover" loading="lazy"
								alt="GIF" />
						</div>
					</template>

					<!-- Empty State -->
					<div x-show="gifResults.length === 0" class="col-span-full py-8 text-center text-gray-500 text-sm">
						Ketik kata kunci lalu tekan ğŸ”
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
}